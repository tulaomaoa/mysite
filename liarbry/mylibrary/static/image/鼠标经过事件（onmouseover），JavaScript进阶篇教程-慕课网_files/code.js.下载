define(function(require){function a(a){var c=[];$.each(h.files,function(a,h){var $={filename:h.filename,lang:h.lang,content:h.content};c.push($)});var j={lang:J,files:c};v.remote[a].set(j)}require("/static/lib/layer/1.6.0/layer.min.js"),require("tab"),require("/static/page/course/common/jquery.nanoscroller.js");var c=require("./common/animate-achievement"),h=require("ceditor"),v=require("/static/page/course/common/course_detail_common.js"),j=(require("../common/verify-code.js"),require("store")),g=function(){var a=$(".J-chaptername").data("id");return $("[data-id="+a+"]")};$(".course-right-nano").hide();var w,b,y={scrollTo:g()};!function(){var a=j.get("ccl");a&&(a=a.split(",")),$("#js-code-container").height($(window).height()-131).show(),$(".nano").nanoScroller(y);var c=$(".js-course-menu"),h=$(".course-left");w=h.offset().top,b=h.offset().left,$(window).on("scroll",function(){var a=$(window).scrollTop();a>=w?c.css("position","fixed").css("left",b+"px"):c.css("position","absolute").css("left",0)})}(),$(window).on("beforeunload",function(){j.set("ccl",$("#js-aticle-container").width()+","+$("#js-editor-container").width())}),$("#js-toggle-width").click(function(){var a,c=$(this);"全屏"==c.text()?(c.find("span").text("收起"),$("#js-result-drag-wrap").hide(),a=$("#js-aticle-container").width(),$("#js-result-container").css({left:a,width:$(window).width()-a})):(c.find("span").text("全屏"),$("#js-result-drag-wrap").show(),a=$("#js-aticle-container").width()+$("#js-editor-container").width(),$("#js-result-container").css({left:a,width:$(window).width()-a}))}),$("#js-toggle-vsb").click(function(){var a,c=$(this);"运行结果"==c.text()?(c.find("span").text("收起结果"),a=$("#js-aticle-container").width(),$("#js-result-container").css({left:a,width:$(window).width()-a}).show()):(c.find("span").text("运行结果"),$("#js-result-container").hide())}),$("#js-result-container,#js-toggle-width").hover(function(){$("#js-toggle-width").css("visibility","visible")},function(){$("#js-toggle-width").css("visibility","hidden")}),$("#js-editor-drag-wrap,#js-result-drag-wrap").hover(function(){$(this).find("div").show()},function(){$(this).find("div").hide()});$(window).on("resize",function(){D()});var C=$("#J_TabType").find("li a"),k=[],_={js:"javascript",py:"python"};C.each(function(i,a){var c=$(a).text().split(".")[1];k.push(_[c]?_[c]:c)});var T=$("#J_EditorTabs").find(".editor-item"),J=($("#J_EditorReset"),$('a[href="#editor-tabs-css"]').attr("href"),$("#J_CodeLang").attr("data-lang")),h=h.init(T);$("#J_EditorTabs").fadeIn(),$(".editor-btn").fadeIn(),$("#J_TabType li:first-child").addClass("ui-tabs-active"),$("#J_TabType li").on("click",function(e){e.preventDefault(),$(this).addClass("ui-tabs-active").siblings().removeClass("ui-tabs-active"),$(".editor-item").addClass("visible-hid").eq($(this).index()).removeClass("visible-hid")});var I=function(){var a={},c=$(".js-editor-tab"),h=c.find(".editor-view"),v=c.find("ul"),j=c.find(".editor-left"),g=c.find(".editor-right"),w=0,b=0,y=[];return v.find("li").each(function(i){var a={};a.index=i,a.width=$(this).outerWidth(!0),a.left=$(this).position().left,y.push(a),w+=a.width}),v.css("width",w+2+"px"),a.resetCount=function(){c.hasClass("js-hasop")&&c.removeClass("js-hasop");var a=h.width();return w>a?(c.addClass("js-hasop"),b=c.find(".ui-tabs-active").index(),v.css("marginLeft",-y[b].left+"px"),void 0):(b=0,void v.css("marginLeft","0px"))},j.on("click",function(){b!==y.length-1&&v.css("marginLeft",-y[++b].left+"px")}),g.on("click",function(){0!==b&&v.css("marginLeft",-y[--b].left+"px")}),a}();$("#js-ques-box").delegate(".Js-change-ques","click",function(){var a,c=$("#ques-group li"),h=$("#ques-group").find("li.curr"),v=h.removeClass("curr").index(),j=c.length-1;v===j?c.eq(0).addClass("curr"):h.next().addClass("curr"),a=$("#ques-group .curr").find(".ques-title").attr("href"),$("#js-to-answer").attr("href",a)}),$("#js-ques-box").on("click","#J_issue_Close,.ques-title,#js-to-answer",function(){$("#J_ques_pop").hide()});var L=function(){var a=($(".course-subnav").width()-$(".course-subnav ul").outerWidth())/2;a>60?$("#js-ques-box").css("left",a):$("#js-ques-box").css("left",60)};$("#J_Commit").on("click",function(){$(this).hasClass("submiting")||($(this).addClass("submiting").html("提交中..."),h.commit(J,function(a){v.tabList&&v.tabList.mate.load();var h=a.data.media,j=a.data.course,a=[];h&&a.push({mp:h.mp.point,desc:h.mp.desc}),j&&a.push({mp:j.mp.point,desc:j.mp.desc}),c(a),h&&($("#J_ques_pop").show(),L())}))}),$("#J_VC_Commit").on("click",function(){var a=$.trim($(".js-verify-code-box .verify-code").find(".verify-code-ipt").val());return""==a?void $(".js-verify-code-box").find(".js-verify-code-tip").html("验证码不能为空").show():a.length<4?void $(".js-verify-code-box").find(".js-verify-code-tip").html("验证码长度过小").show():void($(this).hasClass("submiting")||($(this).addClass("submiting").val("提交..."),$(".js-verify-code-box").find(".js-verify-code-tip").html("").hide(),h.commit(J,function(a){v.tabList&&v.tabList.mate.load();var h=a.data.media,j=a.data.course,a=[];h&&a.push({mp:h.mp.point,desc:h.mp.desc}),j&&a.push({mp:j.mp.point,desc:j.mp.desc}),c(a),h&&($("#J_ques_pop").show(),L())},a)))}),$("#J_Save").on("click",function(){h.runCode(1)}),$(document).on("submit.imooc",function(){h.runCode(1)});var W={init:function(){var a;this.blocks=a=[],a.push({el:$("#js-aticle-container"),width:$("#js-aticle-container").width(),minWidth:parseInt($("#js-aticle-container").css("minWidth"))||320}),a.push({el:$("#js-editor-container"),width:$("#js-editor-container").width(),minWidth:parseInt($("#js-editor-container").css("minWidth"))||400}),a.push({el:$("#js-result-container"),width:$("#js-result-container").width(),minWidth:parseInt($("#js-result-container").css("minWidth"))||130}),$("#js-editor-drager,#js-result-drager").attr("unselectable","on").css("user-select","none").on("selectstart",!1).on("mousedown",$.proxy(this.start,this))},start:function(e){this.splitor=$(e.target).closest("#js-editor-drager").length&&1||2,this.x=e.clientX,$("#js-aticle-container,#js-editor-container,#js-result-container").attr("unselectable","on").css("user-select","none").on("selectstart.codedrager",!1),$(document).on("mousemove.codedrager",$.proxy(this.move,this)),$(document).on("mouseup.codedrager",$.proxy(this.stop,this)),$("#js-result-container").append("<div class='js-result-drag-mask' style='position:absolute;top:0;left:0;right:0;bottom:0;z-index:911;'></div>")},move:function(e){var a,c,h,$,v,j=e.clientX-this.x;j&&(a=this.blocks[this.splitor-1],c=this.blocks[this.splitor],j>0?(h=c,v=1):(h=a,v=-1),$=h.el.width(),j=Math.abs(j),$-j<h.minWidth&&(j=$-h.minWidth),j&&(this.x+=v*j,a.el.css({width:a.el.width()+v*j}),c.el.css({left:parseInt(c.el.css("left"))+v*j,width:c.el.width()-v*j})))},stop:function(){$(document).off("mousemove.codedrager"),$(document).off("mouseup.codedrager"),$("#js-aticle-container,#js-editor-container,#js-result-container").attr("unselectable","off").css("user-select","").off("selectstart.codedrager"),$("#js-result-container").find(".js-result-drag-mask").remove(),$(".editor-item").each(function(){ace.edit(this).renderer.onResize()}),I.resetCount()}},D=function(){var a,c,h,v=$(window),j=v.width()-60,g=v.height();$("#js-code-container").height(g-131),1220>j&&(j=1220),1200>j?($("#js-result-container").hide(),$("#js-result-drag-wrap").hide(),$("#js-toggle-width").hide().find("span").text("全屏"),$("#js-toggle-vsb").show().find("span").text("运行结果"),a=$("#js-aticle-container").width(),c=Math.max(400,j-a),$("#js-aticle-container").css({width:a}),$("#js-editor-container").css({left:a,width:c}),$("#js-result-container").css({left:a+c,width:0})):($("#js-result-container").show(),$("#js-result-drag-wrap").show(),$("#js-toggle-width").show().find("span").text("全屏"),$("#js-toggle-vsb").hide().find("span").text("运行结果"),a=400,h=400,c=j-a-h,$("#js-aticle-container").css({width:a}),$("#js-editor-container").css({left:a,width:c}),$("#js-result-container").css({left:a+c,width:h}));var C=$(".course-left");w=C.offset().top,b=C.offset().left,W.init(),$(".nano").nanoScroller(y),I.resetCount(),$(window).trigger("scroll")};D(),$(document).on("click",".js-mocaptcha-close",function(){$(".captcha-verify-box").addClass("hide").html(""),token=""});var E=function(a){$(a).addClass("hide").html(""),token=""},M="";$(document).on("click","#js-discuss-submit",function(){var c,h,j,g,w={},b=$(this);if($(".qa-pop .js-shot-code").hasClass("on")?a("qa"):v.remote.qa.reset(),!b.hasClass("submit-loading")){if(g=$.trim($("#js-qa-title").val()),g.length<5||g===$("#js-qa-title").attr("placeholder"))return $.prompt("问答标题不能少于5个字",{icon:"error"}),void E(".js-pop-verify-box");if(g.length>255)return $.prompt("问答标题不能大于255个字",{icon:"error"}),void E(".js-pop-verify-box");if(c=UE.getEditor("discuss-editor").getContent(),c=$.trim(c),h=$.trim(UE.getEditor("discuss-editor").getContentTxt()),j=h.length,0==j||"请输入讨论内容..."==h)return $.prompt("请输入讨论内容",{icon:"error"}),void E(".js-pop-verify-box");if(5>j)return $.prompt("输入不能小于5个字符",{icon:"error"}),void E(".js-pop-verify-box");if(j>2e4)return $.prompt("输入不能超过20000个字",{icon:"error"}),void E(".js-pop-verify-box");if($.extend(w,postData),w.content=c,w.title=g,v.remote.qa.prev(w),$(".interal-checked").length&&(w.frommedia=1),"undefined"==typeof token||""==token)return 0!=$(".js-verify-box").length&&E(".js-verify-box"),$(".js-pop-verify-box").removeClass("hide"),M=new mocaptcha(".js-pop-verify-box",{type:0,success:function(t){token=t,$("#js-discuss-submit").trigger("click")}}),void $(".js-mocaptcha").append('<span class="js-mocaptcha-close imv2-close"></span>');w.token=token,b.addClass("submit-loading").val("正在发布...");var y=$("#js-discuss-submit");$.ajax({url:"/course/ajaxsaveques",data:w,type:"post",dataType:"json",success:function(a){0==a.result?($.prompt("发布成功!"),v.tabList.qa.load(),v.remote.qa.reset(),window.qapop.hide(),$("#interal-use").removeClass("interal-checked"),E(".js-pop-verify-box")):-103002==a.result?(M.reset(),token=""):($.prompt(a.msg,{icon:"error"}),E(".js-pop-verify-box"))},complete:function(){y.removeClass("submit-loading").val("发布")}})}}),$(document).on("click","#js-note-submit",function(){var c=$(this),h={};c.hasClass("submit-loading")||($(".note-pop .js-shot-code").hasClass("on")?a("note"):v.remote.note.reset(),h.content=window.noteeditor.getContent(),$.extend(h,postData),v.remote.note.prev(h),"undefined"!=typeof token&&""!=token&&(h.token=token),c.addClass("submit-loading").val("正在保存..."),$.ajax({url:"/course/addnote",type:"post",dataType:"json",data:h,success:function(a){0==a.result?($.prompt("发布成功"),v.tabList.note.load(),v.remote.note.reset(),window.notepop.hide(),$(".js-ower").hasClass("checked")&&($(".js-course-menu").attr("data-ower","all"),$(".js-ower").removeClass("checked")),$(".js-select-state a").removeClass("active"),$(".js-select-state a[data-sort=last]").addClass("active"),E(".js-notepop-verify-box")):1==a.data&&-1==a.result?(0!=$(".js-verify-box").length&&E(".js-verify-box"),$(".js-notepop-verify-box").removeClass("hide"),M=new mocaptcha(".js-notepop-verify-box",{type:0,success:function(t){token=t,$("#js-note-submit").trigger("click")}}),$(".js-mocaptcha").append('<span class="js-mocaptcha-close imv2-close"></span>')):-103002==a.result?(M.reset(),token=""):($.prompt(a.msg,{icon:"error"}),E(".js-notepop-verify-box"))},complete:function(){$("#js-note-submit").removeClass("submit-loading").val("保存")},error:function(){$.prompt("发布失败",{icon:"error"}),E(".js-notepop-verify-box")}}))}),$(function(){function a(a){var c=$(a).attr("href"),h=($('<div id="js-imgview-mask" class="imgview-mask"></div>').appendTo($("body")).fadeIn(),$('<div id="js-imgview" class="show-img"><img id="bigimage" class="imgplacHolder" src="/static/img/loading-small.gif"><a href="#" class="imgview-close" ></a></div>').appendTo($("body"))),v=new Image;v.onload=function(){var a,v=$(window).height()-80,j=$(window).width()-80,g=this.height,w=this.width;(g>v||w>j)&&(a=Math.min(v/g,j/w),g=Math.round(g*a),w=Math.round(w*a)),h.animate({marginTop:-g/2,marginLeft:-w/2,width:w,height:g},200,function(){h.find("img").attr({width:w,height:g,src:c})})},v.src=c}$(document).off("click.closeview").on("click.closeview",".imgview-close,#js-imgview-mask",function(e){e.preventDefault(),$("#js-imgview-mask,#js-imgview").remove()}),$.fn.viewPhoto=function(){$(this).click(function(e){var c=$(e.target);c.is("img")&&c.parent().is("a")&&(a(c.parent()),e.preventDefault())})},$("#J_CodeDescr").viewPhoto()}),$("#J_EditorReset").on("click",function(){h._reset()}),$("#J_CodeQa").find("dt").on("click",function(){$(this).siblings("dd").slideToggle()}),OP_CONFIG.userInfo&&!function(){var a=60,c=(new Date).getTime();setInterval(function(){c=(new Date).getTime(),$.post("/course/ajaxmediauser",{mid:pageInfo.mid,time:a},function(a){"-105002"==a.result&&$.alert("你的账号在另一地点登录，已被强迫下线。",{info:"如果不是本人操作，建议你修改密码。",callback:function(){window.location.href="//coding.imooc.com"}})})},1e3*a),$(window).on("beforeunload",function(){$.ajax({url:"/course/ajaxmediauser",method:"post",async:!1,data:{mid:pageInfo.mid,time:((new Date).getTime()-c)/1e3}})})}();var z=$(".section-list");$(".chapter").on("click",function(){var a=$(this);a.hasClass("light")?(a.removeClass("light"),z.animate({right:-360},200)):(a.addClass("light"),z.animate({right:0},200))})});